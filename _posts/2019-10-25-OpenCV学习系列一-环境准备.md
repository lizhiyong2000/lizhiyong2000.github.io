---
layout: "post"
title: "OpenCV学习系列一-环境准备"
date: "2019-10-25 14:35"
categories: OpenCV
description: OpenCV学习系列一-环境准备
tags: OpenCV PyQT
---

* content
{:toc}

<div class="postImg" style="background-image:url(http://carforeasy.cn/OpenCV学习系列一-a7991521.png)" ></div>

> “OpenCV是一个开源的计算机视觉库，在这个OpenCV Python的教程中，我们将使用PyOpenCV库来学习OpenCV的基本功能，了解计算机视觉处理的基础知识。”





## 1. PyOpenCV环境准备

### 1.1 安装Python
Homebrew是MacOS下的非官方包管理器，一般使用Homebrew来安装MacOS下的常用软件包。

首先安装Homebrew，只需打开终端运行：

```
$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/mast
```

接下来可以开始安装Python 3：

```
$ brew install python3
```

确认下Python的版本：
```
$ python3 --version
Python 3.7.0
$ pip3 --version
pip 19.3.1 from /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/pip (python 3.7)
```

### 1.2 安装Python IDE

可以从intellij idea网站下载免费版PyCharm：
https://www.jetbrains.com/pycharm/


## 1.3 QT图形界面


安装PyQt5：

```
$ pip3 install PyQt5
```

测试PyQT5：

```python
import sys

from PyQt5.QtWidgets import QApplication, QWidget


app = QApplication(sys.argv)
widget = QWidget()
widget.resize(400, 400)
widget.setWindowTitle('Hello World')
widget.show()
sys.exit(app.exec())

```

运行上面的python程序：
![](http://carforeasy.cn/OpenCV学习系列一-c36bf85f.png)

## 1.4 PyOpenCV安装

如果只需要OpenCV核心模块：
```
pip3 install opencv-python
```


如果需要使用其他一些扩展模块：
```
pip3 install opencv-contrib-python
```

## 2. 第一个OpenCV程序

首先修改下主程序结构，使用自定义窗口MainWidget：

```python
import sys

from PyQt5.QtWidgets import QApplication

from MainWidget import MainWidget

app = QApplication(sys.argv)


widget = MainWidget()
widget.resize(960, 600)
widget.setWindowTitle('OpenCV Demo')


widget.show()
sys.exit(app.exec())
```


MainWidget类实现如下，在主窗口中添加一个按钮和一个标签控件，用于加载图片和显示图片。

```python
import cv2.cv2 as cv2
from PyQt5.QtCore import QSize, Qt
from PyQt5.QtGui import QImage, QPixmap

from PyQt5.QtWidgets import QWidget, QPushButton, QFileDialog, QLabel


class MainWidget(QWidget):

    def __init__(self):
        super(MainWidget, self).__init__()

        self.btn = QPushButton("Load Image", self)

        self.btn.clicked.connect(self.load_image)
        self.btn.resize(100, 30)
        self.btn.move(10, 10)

        self.image_label = QLabel(self)
        self.image_label.setText("image")
        self.image_label.resize(300, 300)
        self.image_label.move(10, 50)
        # self.image_label.setScaledContents(True)
        self.image_label.setStyleSheet("border: 1px solid red")

    def load_image(self):
        fname, _ = QFileDialog.getOpenFileName(self, 'Open file', '/', "Image files (*.jpg *.png)")

        if len(fname) > 0:
            image = cv2.imread(fname)
            # cv2.imshow(fname, image)

            height, width, bytesPerComponent = image.shape
            bytesPerLine = 3 * width
            cv2.cvtColor(image, cv2.COLOR_BGR2RGB, image)
            qimage = QImage(image.data, width, height, bytesPerLine, QImage.Format_RGB888)
            pixmap = QPixmap.fromImage(qimage)

            pixmap = pixmap.scaled(QSize(self.image_label.width(), self.image_label.height()), Qt.KeepAspectRatio, Qt.SmoothTransformation);

            self.image_label.setPixmap(pixmap)
```

运行程序，加载Lenna.jpg：

![](http://carforeasy.cn/OpenCV学习系列一-00b82293.png)

## 3. 参考链接

+ [Mac下Homebrew的安装与使用](https://www.jianshu.com/p/bca8fc1ff3f0)
+ [如何在Python下搭建QT+SIP+PyQt5环境](https://www.jianshu.com/p/291cd624ec9d)
