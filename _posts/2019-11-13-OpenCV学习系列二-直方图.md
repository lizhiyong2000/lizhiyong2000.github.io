---
layout: "post"
title: "OpenCV学习系列二-直方图"
date: "2019-11-13 14:35"
categories: OpenCV
description: OpenCV学习系列二-直方图
tags: OpenCV PyQT
---

* content
{:toc}

<div class="postImg" style="background-image:url(http://carforeasy.cn/OpenCV学习系列二-d0ba5d6b.png)" ></div>

> “OpenCV是一个开源的计算机视觉库，在这个OpenCV Python的教程中，我们将使用PyOpenCV库来学习OpenCV的基本功能，了解计算机视觉处理的基础知识，本文学习如何计算图像的直方图。”





## 1. 直方图概念

### 1.1 直方图
直方图(Histogram)，又称质量分布图，是一种统计报告图，由一系列高度不等的纵向条纹或线段表示数据分布的情况。 一般用横轴表示数据类型，纵轴表示分布情况。

图像的直方图是对图像像素的统计分布，对于灰度图像它统计了每个像素颜色（0到255）的数量。对于彩色图像（RGB），可统计在R、G、B各个分量上的直方图分布。


![](http://carforeasy.cn/OpenCV学习系列二-f4a7da9b.png)

OpenCV中提供了calcHist进行图像的直方图计算。

```python
cv2.calcHist(images, channels, mask, histSize, ranges[, hist[, accumulate ]])
```

+ 第一个参数表示用来计算直方图的图像。
+ 第二个参数是用于表示计算直方图的通道，如果使用灰度图计算直方图则传入[0]，如果使用RGB图像，则传入RGB各自对应的通道。
+ 第三个参数是Mask，通常用来对图像特定区域计算直方图时使用。
+ 第四个参数是histSize，表示这个直方图分成多少份（即多少个直方柱）。
+ 第五个参数是表示直方图中各个像素的值，[0.0, 255.0]表示直方图能表示像素值从0.0到255的像素。
+ 最后是两个可选参数，由于直方图作为函数结果返回了，所以第六个hist就没有意义了（待确定）
+ 最后一个accumulate是一个布尔值，用来表示直方图是否叠加。

### 1.2 直方图均衡化

直方图均衡化就是将原始的直方图拉伸，使之均匀分布在全部灰度范围内，从而增强图像的对比度。
直方图均衡化的中心思想是把原始图像的的灰度直方图从比较集中的某个区域变成在全部灰度范围内的均匀分布。

## 2. 计算直方图

直方图的计算比较直接，下面提供两个显示直方图的示例：


+ 方法一：

```python
def show_histogram(self):
    # hist = cv2.calcHist([self.image],
    #                     [0], #使用的通道
    #                     None, #没有使用mask
    #                     [256], #HistSize
    #                     [0.0,255.0])

    b, g, r = cv2.split(self.image)
    numbins = 256
    ranges = [0.0, 256.0]

    b_hist = cv2.calcHist([b], [0], None, [numbins], ranges)
    g_hist = cv2.calcHist([g], [0], None, [numbins], ranges)
    r_hist = cv2.calcHist([r], [0], None, [numbins], ranges)

    print(b_hist.shape)

    width = 256
    height = 256

    hist_image = np.zeros([height, width, 3], np.uint8)

    cv2.normalize(b_hist, b_hist, 0, height * 0.9, cv2.NORM_MINMAX)
    cv2.normalize(g_hist, g_hist, 0, height * 0.9, cv2.NORM_MINMAX)
    cv2.normalize(r_hist, r_hist, 0, height * 0.9, cv2.NORM_MINMAX)

    for i in range(1, numbins, 1):
        cv2.line(hist_image,
                 (i - 1, height - np.int32(np.around(b_hist[i - 1][0]))),
                 (i, height - np.int32(np.around(b_hist[i][0]))),
                 (255, 0, 0)
                 )
        cv2.line(hist_image,
                 (i - 1, height - np.int32(np.around(g_hist[i - 1][0]))),
                 (i, height - np.int32(np.around(g_hist[i][0]))),
                 (0, 255, 0)
                 )
        cv2.line(hist_image,
                 (i - 1, height - np.int32(np.around(r_hist[i - 1][0]))),
                 (i, height - np.int32(np.around(r_hist[i][0]))),
                 (0, 0, 255)
                 )

    # cv2.imshow("Histogram", hist_image)
    demo_utils.show_cvimage_to_label(hist_image, self.histogram_label)
```

+ 方法二：

```python
def show_histogram2(self):
        # hist = cv2.calcHist([self.image],
        #                     [0], #使用的通道
        #                     None, #没有使用mask
        #                     [256], #HistSize
        #                     [0.0,255.0])

        # b, g, r = cv2.split(self.image)
        numbins = 256
        ranges = [0.0, 255.0]

        width = 256
        height = 256

        bytes_per_line = 3 * width

        hist_image = np.zeros([height, width, 3], np.uint8)

        # hist_image = np.zeros((256,256,3)) #创建用于绘制直方图的全0图像

        bins = np.arange(numbins).reshape(numbins, 1)  # 直方图中各bin的顶点位置

        color = [(255, 0, 0), (0, 255, 0), (0, 0, 255)]  # BGR三种颜色

        for ch, col in enumerate(color):
            origin_hist = cv2.calcHist([self.image], [ch], None, [numbins], ranges)
            cv2.normalize(origin_hist, origin_hist, 0, 255 * 0.9, cv2.NORM_MINMAX)
            hist = np.int32(np.around(origin_hist))
            pts = np.column_stack((bins, hist))
            cv2.polylines(hist_image, [pts], False, col)

        # print(type(hist_image.data))

        hist_image = np.flipud(hist_image)
        demo_utils.show_cvimage_to_label(hist_image, self.histogram_label2)
```

其中计算直方图得方法是完全一样的，只是显示直方图时，方法二使用了column_stack和polylines函数。

运行程序，加载lena.png和灰度图lena_gray.png：

![](http://carforeasy.cn/OpenCV学习系列二-02f630d9.png)

示例代码：https://github.com/lizhiyong2000/tutorials/tree/master/OpenCVDemo

## 3. 参考链接

+ [Opencv-Python学习笔记七——图像直方图 calcHist，直方图均衡化equalizeHist](https://www.jianshu.com/p/bd12c4273d7d)
+ [OpenCV Python教程（3、直方图的计算与显示）](https://blog.csdn.net/sunny2038/article/details/9097989)
+ [直方图均衡化算法原理与实现](https://blog.csdn.net/qianqing13579/article/details/52422364)
