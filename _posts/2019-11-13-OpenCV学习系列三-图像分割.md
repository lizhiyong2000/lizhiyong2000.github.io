---
layout: "post"
title: "OpenCV学习系列三-图像分割"
date: "2019-11-13 15:35"
categories: OpenCV
description: OpenCV学习系列三-图像分割
tags: OpenCV PyQT
---

* content
{:toc}

<div class="postImg" style="background-image:url(http://carforeasy.cn/OpenCV学习系列三-643275ff.png)" ></div>

> “OpenCV是一个开源的计算机视觉库，在这个OpenCV Python的教程中，我们将使用PyOpenCV库来学习OpenCV的基本功能，了解计算机视觉处理的基础知识，本文学习如何计算图像的直方图。”





## 1. 图像分割概念

### 1.1 图像分割
图像分割是图像分析的第一步，是计算机视觉的基础，是图像理解的重要组成部分，同时也是图像处理中最困难的问题之一。所谓图像分割是指根据灰度、彩色、空间纹理、几何形状等特征把图像划分成若干个互不相交的区域，使得这些特征在同一区域内表现出一致性或相似性，而在不同区域间表现出明显的不同。简单的说就是在一副图像中，把目标从背景中分离出来。

图像分割的算法有很多，本文介绍最简单的基于阈值的分割。


### 1.2 基于阈值的图像分割

阈值法的基本思想是基于图像的灰度特征来计算一个或多个灰度阈值，并将图像中每个像素的灰度值与阈值作比较，最后将像素根据比较结果分到合适的类别中。因此，该方法最为关键的一步就是按照某个准则函数来求解最佳灰度阈值。

阈值法特别适用于目标和背景占据不同灰度级范围的图。

[](http://carforeasy.cn/OpenCV学习系列三-643275ff.png)

## 2. 示例

### 2.1 图像去噪

```python
def remove_noise(self):

    height, width, bytes_per_component = self.image.shape
    bytes_per_line = 3 * width

    self.noise_image = np.zeros(self.image.shape, np.uint8)

    cv2.medianBlur(self.image, 3, self.noise_image)

    demo_utils.show_cvimage_to_label(self.noise_image, self.noise_label)

```

### 2.2 背景剔除

```python
def remove_light(self):

    height, width, bytes_per_component = self.image.shape
    bytes_per_line = 3 * width

    img32 = np.float32(self.noise_image)
    light32 = np.float32(self.light_image)
    #
    devided = np.divide(img32, light32)

    sub_result = 1 - devided

    aux = abs(255 * sub_result)
    self.light_removed_image = np.uint8(aux)

    # light_removed_image = abs(light32 - img32)
    # light_removed_image = np.uint8(light_removed_image)

    # light_removed_image = np.zeros(self.image.shape, np.uint8)
    # cv2.medianBlur(self.image, 3, light_removed_image)

    demo_utils.show_cvimage_to_label(self.light_removed_image, self.light_removed_label)
```


### 2.3 二值化分割

其中计算直方图得方法是完全一样的，只是显示直方图时，方法二使用了column_stack和polylines函数。

```python
def apply_threshold(self):

    height, width, bytes_per_component = self.image.shape
    bytes_per_line = 3 * width

    self.threshold_image = np.zeros(self.image.shape, np.uint8)
    cv2.threshold(self.light_removed_image, 50, 255, cv2.THRESH_BINARY, self.threshold_image)

    demo_utils.show_cvimage_to_label(self.threshold_image, self.threshold_label)

    imgray = cv2.cvtColor(self.threshold_image, cv2.COLOR_BGR2GRAY)

    result = cv2.connectedComponentsWithStats(imgray)

    # cv2.CC_STAT_AREA

    print(" %d objects found" % result[0])
    num_labels = result[0]
    # The second cell is the label matrix
    labels = result[1]
    stats = result[2]
    controlids = result[3]

    output = np.zeros(self.image.shape, np.uint8)

    random.seed()

    font = cv2.FONT_HERSHEY_SIMPLEX

    # org
    org = (50, 50)

    # fontScale
    fontScale = 0.5

    # Blue color in BGR
    color1 = (255, 0, 0)

    # Line thickness of 2 px
    thickness = 1

    outputed = False
    for i in range(1, num_labels):
        area = stats[i][cv2.CC_STAT_AREA]
        if area > 10:
            print("object:%d with area %d" % (i, area))
            mask = labels == i

            color = (random.randint(40, 220), random.randint(40, 220), random.randint(40, 220))

            # np.putmask(output, mask, [color])

            output[mask] = color

            # Using cv2.putText() method

            # if not outputed:

            print(controlids[i])

            org = controlids[i].astype(int)

            output = cv2.putText(output, "area: %d" % (area), tuple(org), font,
                                 fontScale, color, thickness)

    demo_utils.show_cvimage_to_label(output, self.segment_label)
```

运行程序，先分布加载待分割图像和背景图像，然后进行分割：

![](http://carforeasy.cn/OpenCV学习系列三-6de94d84.png)

示例代码：[https://github.com/lizhiyong2000/tutorials/tree/master/OpenCVDemo](https://github.com/lizhiyong2000/tutorials/tree/master/OpenCVDemo)

## 3. 参考链接
+ [最全综述 | 图像分割算法](https://zhuanlan.zhihu.com/p/70758906)
+ [图像分割·阈值化分割](https://blog.csdn.net/u010189457/article/details/78358410)
